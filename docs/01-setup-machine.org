* Set up Environment

Kubernetes environment with ASB (Ansible Service Broker) will be installed on your machine at the end of this exercise.

[Official Getting started docs](https://github.com/openshift/ansible-service-broker/blob/master/README.md) for Ansible Service Broker.

** Prerequisites
- Installed ~kvm~, ~virtualbox~ or ~hyperv~ (for minikube provisioning)
- [[https://kubernetes.io/docs/tasks/tools/install-minikube/][Install minikube]]
  - Either use default vm driver for minikube or config ~minikube~ to change it, e.g. for kvm2:
    - ~minikube config set vm-driver kvm2~
  - Make sure ~minikube start~ and ~minikube delete~ are working.
- [[https://kubernetes.io/docs/tasks/tools/install-kubectl/][Install kubectl]] (v1.9.4)
- [[https://github.com/ansibleplaybookbundle/ansible-playbook-bundle/blob/master/docs/apb_cli.md#installing-the-apb-tool][Install apb ]](Ansible Playbook Bundle) tool either with
  - Docker
    - ~git clone https://github.com/ansibleplaybookbundle/ansible-playbook-bundle.git~
    - ~YOUR_PATH_DIR=~/bin~
    - ~PATH=${YOUR_PATH_DIR}:${PATH}~
    - ~cp ansible-playbook-bundle/scripts/apb-docker-run.sh ${YOUR_PATH_DIR}/apb && chmod +x ${YOUR_PATH_DIR}/apb~
  - RPM (Fedora 26/27)
    - ~sudo dnf -y install dnf-plugins-core~
    - ~sudo dnf -y copr enable @ansible-service-broker/ansible-service-broker-latest~
    - ~sudo dnf -y install apb~
  - RPM (Centos 7)
    - ~sudo yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm~
    - ~sudo yum -y install apb~
  - Verify
- [[https://docs.helm.sh/using_helm/#install-helm][Install the helm]] binary
- [[https://github.com/kubernetes-incubator/service-catalog/blob/master/docs/install.md#installing-the-service-catalog-cli][Install the svcat]] binary
- Clone the [[https://github.com/openshift/ansible-service-broker][Service Broker GitHub repository]]

** Setup kubernetes

*** Start minikube
#+BEGIN_SRC bash
minikube start --bootstrapper kubeadm --kubernetes-version v1.9.4
#+END_SRC
*** Install helm and tiller
#+BEGIN_SRC bash
# https://docs.helm.sh/using_helm/#install-helm
# Install
helm init --wait

# Setup RBAC rules
kubectl create clusterrolebinding tiller-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:default
#+END_SRC

*** Install Service Catalog
#+BEGIN_SRC bash
# Adds the chart repository for the service catalog
helm repo add svc-cat https://svc-catalog-charts.storage.googleapis.com

# Installs the service catalog helm install svc-cat/catalog --name catalog --namespace catalog
helm install --wait svc-cat/catalog --name catalog --namespace catalog
#+END_SRC

*** Install Service Broker

#+BEGIN_SRC bash
./scripts/run_latest_k8s_build.sh
#+END_SRC
